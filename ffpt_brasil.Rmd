---
title: Análise Exploratória dos municípios que adotaram política de isenção de tarifa
  no transporte público
author: "Thais Fernandes Pereira"
date: "Julho de 2021"
output:
  html_document:
    theme: flatly  
    self-contained: true
    toc: true
    toc_float: true
    css:
      - estilo.css
---

```{r setup, include=FALSE, out.width="50%"}
(knitr::opts_chunk$set(echo=FALSE, error=FALSE, warning=FALSE, message=FALSE)) 
```

```{css Estilo do Relatório, eval=FALSE, include=FALSE}

h1.title{ 
    color: #00688B;
    font-size: 23px;
    text-align: center;
    font-weight: bold;
}

h4.author{ 
    color: #00688B;
    font-size: 16px;
    text-align: center;
    font-weight: bold;
}

h4.date{ 
    color: #00688B;
    font-size: 16px;
    text-align: center;
    font-weight: bold;
}

p{
  text-align: justify;
  font-size: 11px
}



```

```{r Pacotes}

library("tidyverse")
library("kableExtra")
library("knitr")
library("tidylog")
library("DT")
library("kableExtra")
library("knitr")
library("tidylog")
library("readxl")
library("geobr")
library("sf")
library("wesanderson")
library("ggplot2")
library("stringr")
library("stargazer")
library ("abjData")
library("extrafont")
library("gganimate")
library("gifski")
library("av")
library("lubridate")
library("transformr")
library("reactable")
library("rnaturalearth")
library("rgeos")
library("plotly")
library("ggrepel")

```

```{r baixando arquivos}

# Baixando Arquivos da internet

file1 <- "https://raw.githubusercontent.com/thais01fernandes/C-Users-Thais.Pereira-Documents-pessoal-mestrado-An-lise-Mestrado/main/munic_pop.csv"
munic_pop <- read_delim(file1, delim = ";", 
                         locale = locale(encoding='latin1'))

file2 <- "https://raw.githubusercontent.com/thais01fernandes/C-Users-Thais.Pereira-Documents-pessoal-mestrado-An-lise-Mestrado/main/PIB%20dos%20Munic%C3%ADpios%20-%20base%20de%20dados%202010-2018.csv"
munic_pib <- read_delim(file2, delim = ";", 
                         locale = locale(encoding='latin1'))

file3 <- "https://raw.githubusercontent.com/thais01fernandes/C-Users-Thais.Pereira-Documents-pessoal-mestrado-An-lise-Mestrado/main/idh_muni.csv"
munic_idh <- read_delim(file3, delim = ",")

file4 <- "https://raw.githubusercontent.com/thais01fernandes/C-Users-Thais.Pereira-Documents-pessoal-mestrado-An-lise-Mestrado/main/PlanosdeMobilidadeUrbana.csv"
plano_mob <- read_delim(file4, delim = ",")

file5 <- "https://raw.githubusercontent.com/thais01fernandes/C-Users-Thais.Pereira-Documents-pessoal-mestrado-An-lise-Mestrado/main/ginibr.csv"
munic_gini <- read_delim(file5, delim = ";", 
                         locale = locale(encoding='latin1'))

file6 <- "https://raw.githubusercontent.com/thais01fernandes/Analises-Mestrado/main/dados_ipea.csv"
indice_ipea <- read_delim(file6, delim = ",")

file7 <- "https://raw.githubusercontent.com/thais01fernandes/Analises-Mestrado/main/area_territorial.csv"
area_territorial <- read_delim(file7, delim = ",")


```


```{r Organização da base Parte 1}

# organizando o banco de dados completo com todos os municípios e distiguindo os municícpio com FFPT}
# Os dados do índice de vulnerabilidade econômica foram retirados do site do ipea: http://ivs.ipea.gov.br/index.php/pt/planilha 
# e produzidos com dados do IBGE de 2010. 

indice_ipea$Município <- as.numeric(indice_ipea$Município)

banco_completo <- pnud_muni %>% 
  filter(ano == 2010) %>% 
  select(uf, ufn,municipio, codmun6,codmun7, rdpc, pesourb, pesorur, pesotot, theil, gini, idhm_r, idhm_l, idhm_e, idhm,t_ocupdesloc_1, 	
       pmpob, t_ativ18m) %>% 
  rename(CodMun = codmun7) %>% 
  mutate(tarifa_zero = case_when(CodMun == 3302700 ~ "sim",
                                 CodMun == 2303709~ "sim",
                                 CodMun == 3133709~ "sim",
                                 CodMun == 3519055~ "sim" ,
                                 CodMun == 2304285~ "sim", 
                                 CodMun == 3500709 ~ "sim" , 
                                 CodMun == 3556453~ "sim", 
                                 CodMun == 3528007~ "sim", 
                                 CodMun == 3540804~ "sim" , 
                                 CodMun == 4128500~ "sim", 
                                 CodMun == 4119608~ "sim" , 
                                 CodMun == 4111506~ "sim" , 
                                 CodMun == 3143104~ "sim" ,
                                 CodMun == 3539103~ "sim" , 
                                 CodMun == 3305604~ "sim", 
                                 CodMun == 3144102~ "sim",
                                 CodMun == 3111200~ "sim", 
                                 CodMun == 5201306~ "sim", 
                                 CodMun == 4107603~ "sim", 
                                 CodMun == 3104106~ "sim" ,
                                 CodMun == 3116605~ "sim" , 
                                 CodMun == 3100203~ "sim" ,
                                 CodMun == 5202502~ "sim" , 
                                 CodMun == 3514304~ "sim", 
                                 CodMun == 3511508~ "sim" , 
                                 CodMun == 4314209~ "sim" ,
                                 CodMun == 2301000~ "sim" ,
                                 CodMun == 3532009~ "sim", 
                                 CodMun == 5208004~ "sim", 
                                 CodMun == 3110004~ "sim", TRUE ~ "não")) %>% 
  mutate(tarifa_zero = case_when(CodMun == 3172202~ "não", TRUE ~ tarifa_zero)) %>% 
  left_join(munic_pop, by = "CodMun") %>% 
  select(-`COD UF`, -UF, -`NOME MUNIC`) %>% 
  mutate(`CLASSE POP` = gsub(pattern = "1 -|2 -|3 -|4 -|5 -|6 -|7 -",replacement = "",`CLASSE POP`)) %>% 
  mutate(REGIAO = gsub(pattern = "1 -|2 -|3 -|4 -|5 -",replacement = "", REGIAO)) %>% 
  mutate(`CLASSE POP` = gsub("Até 5000","Até 5.000", `CLASSE POP`)) %>% 
  mutate(`CLASSE POP` = gsub("5001 até 10000","5.000 Até 10.000", `CLASSE POP`)) %>%  
  mutate(`CLASSE POP` = gsub("10001 até 20000","10.000 Até 20.000", `CLASSE POP`)) %>% 
  mutate(`CLASSE POP` = gsub("20001 até 50000","20.000 Até 50.000", `CLASSE POP`)) %>% 
  mutate(`CLASSE POP` = gsub("50001 até 100000","50.000 Até 100.000", `CLASSE POP`)) %>% 
  mutate(`CLASSE POP` = gsub("100001 até 500000","100.000 Até 500.000",`CLASSE POP`)) %>%
  mutate(`CLASSE POP` = gsub("Maior que 500000","Maior que 500.000", `CLASSE POP`)) %>% 
  left_join(indice_ipea, by = c("CodMun" = "Município")) %>% 
  left_join(area_territorial, by = c("CodMun"))
 
  
```

```{r Organização da base Parte 2}

# Criando um data frame com o ano de implatanção da Política

# Essa informação foi coletada da dissertação de Mestrado de Marijke Vermander, "EXPLORING FARE-FREE PUBLIC
# TRANSPORT IN BRAZIL Rationales and characteristics of Tarifa Zero policies in small Brazilian municipalities, 2021"

ano_implementacao <- tibble(CodMun=c(3100203, 3500709, 5201306, 2301000,
                      3104106, 5202502, 3111200, 3511508, 
                      3116605, 3514304, 2304285, 4107603, 3519055,3133709, 
                      4111506, 3528007, 3302700, 3143104, 3532009,3144102,4314209, 
                      3539103,4119608, 3540804,3305604, 3556453,4128500, 5208004, 3110004,2303709),
       ano_implementacao=c(1997, 2003, 2014, 2018, 2019, 2008, 2019, 2020, 2021, 
             2014, 2010, 2001, 2010, 2015, 2001, 2004, 2013, 1994,2019,2011,2018,2020, 2012, 1998, 2014,2019, 2008, 2021, 2021, 2021), 
       ano_implemen_resumido=c("Até anos 2000", "Entre 2001 e 2009", "Entre 2010 e 2015", "Entre 2016 e 2021", "Entre 2016 e 2021", "Entre 2001 e 2009", "Entre 2016 e 2021", "Entre 2016 e 2021", "Entre 2016 e 2021", "Entre 2010 e 2015", "Entre 2010 e 2015", "Entre 2001 e 2009", "Entre 2010 e 2015", "Entre 2010 e 2015", "Entre 2001 e 2009", "Entre 2001 e 2009", "Entre 2010 e 2015", "Até anos 2000", "Entre 2016 e 2021", "Entre 2010 e 2015", "Entre 2016 e 2021", "Entre 2016 e 2021", "Entre 2010 e 2015", "Até anos 2000", "Entre 2010 e 2015", "Entre 2016 e 2021", "Entre 2001 e 2009", "Entre 2016 e 2021", "Entre 2016 e 2021","Entre 2016 e 2021"))

banco_completo_1 <- banco_completo %>% 
  left_join(ano_implementacao, by = "CodMun")

```

```{r Organização da base Parte 3}

# PIB dos municípios, IBGE 2018: 
# O banco de dados de PIB contém dados de 2018 e portando mais municípios do que o banco inicial, pnud_muni, que contém dados de 2010

munic_pib_filtrado <- munic_pib %>% 
  filter(Ano == 2018) %>% 
  select(Ano, `Código do Município`,`Produto Interno Bruto per capita, \na preços correntes\n(R$ 1,00)`, `Nome da Grande Região`, `Sigla da Unidade da Federação`) %>% 
  rename(CodMun =`Código do Município`, Pib_Municipal_2018 =`Produto Interno Bruto per capita, \na preços correntes\n(R$ 1,00)`, Regiao = `Nome da Grande Região`, UF = `Sigla da Unidade da Federação`)

banco_completo_2 <- banco_completo_1 %>% 
  left_join(munic_pib_filtrado, by = "CodMun") %>% 
  select(- Ano.y, -Regiao, -`Nome do Município`, -`Município com 6 dígitos`, -Ano.x, -UF.x, - `Nome da UF`) 

```

```{r Organização da base Parte 4}

# Plano de Mobilidade 
# O banco de dados de Plano de Mobilidade contém dados de 2018 e portando mais municípios do que o banco inicial, pnud_muni, que contém dados de 2010
# retirado do site oficial do governo: https://www.gov.br/mdr/pt-br/assuntos/mobilidade-e-servicos-urbanos/planejamento-da-mobilidade-urbana/levantamento-sobre-a-situacao-dos-planos-de-mobilidade-urbana

  plano_mob_1 <- plano_mob %>%
  select (`código do município - IBGE`,`Possui Plano de Mobilidade Urbana`, 
          `Ano de elaboração`, `Aprovado em lei ou ato normativo`,
          `Instrumento Legal`,`Nº da Lei`) %>% 
  rename(CodMun = `código do município - IBGE`)

  plano_mob_1$CodMun <- as.numeric(plano_mob_1$CodMun)

  banco_completo_3 <- banco_completo_2 %>% 
  left_join(plano_mob_1, by = "CodMun")

```

```{r Organização da base Parte 5}

# taxa de urbanização dos municípios com base em dados de estimativa de 2019 do IBGE
# densidade demográfica dos municípios com base em dados da pop de estimativa de 2019 e área total de 2020 do IBGE


  banco_completo_4 <- banco_completo_3 %>% 
  mutate(taxa_urbanizacao = pesourb/pesotot) %>% 
  mutate(densidade_demografica = pesotot/area_territorial)
  


```

```{r Organização da base Parte 6}

# organização dos dados 

  banco_completo_5 <-banco_completo_4 %>% 
  rename(cod_uf = uf, 
         uf = ufn,
         UF = UF.y,
         nome_muni = municipio, 
         cod_muni_1 = codmun6, 
         renda_percapta_media = rdpc, 
         pop_urbana = pesourb, 
         pop_rural = pesorur, 
         pop_total = pesotot,    
         indice_theil = theil, 
         indice_gini = gini, 
         ocup_desl = t_ocupdesloc_1, 
         pct_pobres = 	pmpob, 
         taxa_atividade_18_anos_ou_mais = t_ativ18m, 
         pop_estimada_2019 = `POP EST`,  
         classe_pop = `CLASSE POP`,
         plano_mob = `Possui Plano de Mobilidade Urbana`, 
         ano_elaboracao = `Ano de elaboração`, 
         pop_total_2010 = pesotot,
         indice_ivs = IVS, 
         ivs_infra_urbana = `IVS Infraestrutura Urbana`, 
         ivs_capital_humano = `IVS Capital Humano`, 
         ivs_renda_trabalho = `IVS Renda e Trabalho`,
         pct_domicilios_agua_esgosto_sanitario_inadequado = `% de pessoas em domicílios com abastecimento de água e esgotamento sanitário inadequados`,
         pct_pop_domicilios_urbanos_sem_coleta_lixo = `% da população que vive em domicílios urbanos sem o serviço de coleta de lixo`, 
         prosperidade_social = `Prosperidade Social`, 
         pop_vulneravel_retorna_diariamente_trabalho = `População ocupada vulnerável à pobreza que retorna diariamente do trabalho`, 
         pct_formalizacao_18_ou_mais = `Grau de formalização dos ocupados - 18 anos ou mais`) %>% 
  select(REGIAO, 
       UF, 
       uf, 
       cod_uf, 
       nome_muni, 
       cod_muni_1, 
       CodMun, 
       tarifa_zero, 
       ano_implementacao, 
       ano_implemen_resumido, 
       renda_percapta_media, 
       Pib_Municipal_2018, 
       pct_pobres,  
       ocup_desl, 
       taxa_atividade_18_anos_ou_mais, 
       classe_pop,
       prosperidade_social, 
       pop_urbana, 
       area_territorial, 
       densidade_demografica,
       pop_rural,taxa_urbanizacao,
       pct_domicilios_agua_esgosto_sanitario_inadequado,
       pct_pop_domicilios_urbanos_sem_coleta_lixo,
       pop_vulneravel_retorna_diariamente_trabalho, 
       pct_formalizacao_18_ou_mais, 
       pop_estimada_2019, 
       pop_total_2010,
       indice_ivs, 
       ivs_infra_urbana, 
       ivs_capital_humano, 
       ivs_renda_trabalho, 
       indice_theil, 
       indice_gini, 
       idhm, idhm_e,  
       idhm_l, idhm_r,
       plano_mob,
       ano_elaboracao,
       `Aprovado em lei ou ato normativo`,
       `Instrumento Legal`, `Nº da Lei`)  %>% 
  mutate(idhm_class = case_when(idhm > 0 & idhm <= 0.499 ~ "Muito Baixo", 
                                        idhm  >= 0.500 & idhm <= 0.599 ~ "Baixo", 
                                        idhm  >= 0.600 & idhm <= 0.699 ~ "Médio", 
                                        idhm  >= 0.700 & idhm <= 0.799 ~"Alto", 
                                        idhm  >= 0.800 ~ "Muito Alto", TRUE ~ "idhm")) %>% 
  mutate(idhm_r_class = case_when(idhm_r > 0 & idhm_r <= 0.499 ~ "Muito Baixo", 
                                        idhm_r  >= 0.500 & idhm_r <= 0.599 ~ "Baixo", 
                                        idhm_r  >= 0.600 & idhm_r <= 0.699 ~ "Médio", 
                                        idhm_r  >= 0.700 & idhm_r <= 0.799 ~"Alto", 
                                        idhm_r  >= 0.800 ~ "Muito Alto", TRUE ~ "idhm")) %>% 
  mutate(idhm_e_class = case_when(idhm_e > 0 & idhm_e <= 0.499 ~ "Muito Baixo", 
                                        idhm_e  >= 0.500 & idhm_e <= 0.599 ~ "Baixo", 
                                        idhm_e  >= 0.600 & idhm_e <= 0.699 ~ "Médio", 
                                        idhm_e  >= 0.700 & idhm_e <= 0.799 ~"Alto", 
                                        idhm_e  >= 0.800 ~ "Muito Alto", TRUE ~ "idhm")) %>% 
  mutate(idhm_l_class = case_when(idhm_l > 0 & idhm_l <= 0.499 ~ "Muito Baixo", 
                                        idhm_l  >= 0.500 & idhm_l <= 0.599 ~ "Baixo", 
                                        idhm_l  >= 0.600 & idhm_l <= 0.699 ~ "Médio", 
                                        idhm_l  >= 0.700 & idhm_l <= 0.799 ~"Alto", 
                                        idhm_l  >= 0.800 ~ "Muito Alto", TRUE ~ "idhm")) %>% 
   mutate(ivs_class = case_when(indice_ivs >= 0 & indice_ivs <= 0.200 ~ "Muito Baixa", 
                                         indice_ivs  >= 0.201 & indice_ivs <= 0.300 ~ "Baixa", 
                                         indice_ivs  >= 0.301 & indice_ivs <= 0.400 ~ "Média", 
                                         indice_ivs  >= 0.401 ~"Alta", TRUE ~ "indice_ivs")) %>% 
   mutate(ivs_infra_urbana_class = case_when(ivs_infra_urbana >= 0 & ivs_infra_urbana <= 0.200 ~ "Muito Baixa", 
                                        ivs_infra_urbana  >= 0.201 & ivs_infra_urbana <= 0.300 ~ "Baixa", 
                                        ivs_infra_urbana  >= 0.301 & ivs_infra_urbana <= 0.400 ~ "Média", 
                                        ivs_infra_urbana  >= 0.401 ~"Alta",  TRUE ~ "indice_ivs")) %>% 
  mutate(ivs_renda_trab_class = case_when(ivs_renda_trabalho >= 0 & ivs_renda_trabalho <= 0.200 ~ "Muito Baixa", 
                                       ivs_renda_trabalho  >= 0.201 & ivs_renda_trabalho <= 0.300 ~ "Baixa", 
                                       ivs_renda_trabalho  >= 0.301 & ivs_renda_trabalho <= 0.400 ~ "Média", 
                                       ivs_renda_trabalho  >= 0.401 ~"Alta",  TRUE ~ "indice_ivs")) %>% 
  mutate(ivs_cap_class = case_when(ivs_capital_humano >= 0 & ivs_capital_humano <= 0.200 ~ "Muito Baixa", 
                                       ivs_capital_humano  >= 0.201 & ivs_capital_humano <= 0.300 ~ "Baixa", 
                                       ivs_capital_humano  >= 0.301 & ivs_capital_humano <= 0.400 ~ "Média", 
                                       ivs_capital_humano  >= 0.401 ~"Alta", TRUE ~ "indice_ivs")) %>% 
  mutate(taxa_pop_vulneravel_retorna_diariamente_trabalho = pop_vulneravel_retorna_diariamente_trabalho/pop_estimada_2019)


# transformando algumas variáveis em numéricas:

banco_completo_5[21:30] <- lapply(banco_completo_5[21:30], as.numeric)


```



## 1. Abstract

O objeto de estudo da pesquisa a qual esse relatório se refere tem como
recorte empírico o estudo de 30 cidades brasileiras que adotaram a
isenção integral da tarifa no transporte público. Para a seleção dos
casos foram utilizados dois critérios definidos por Klebowski (2019)
para o estudo do que o autor conceitua como Free Fare Public Transport:
i. A política foi implantada na maioria das redes de transporte da
cidade; ii. Está disponível para a maioria dos seus usuários, durante a
maior parte do tempo. Este autor define a política de isenção de tarifa
no transporte público como uma forma particular de subsídio público
adotada por governos locais em duas principais modalidades: parcial e
completa. O foco principal dessa agenda de pesquisa é o estudo da
política em seu formato completo, ou seja, o subsídio integral do valor
da tarifa, sendo um dos objetivos centrais entender quais são os motivos
que levam um governo local a adotar essa política. Também utilizaremos o
termo FFTP para se referir a política, abreviação de Free Fare Public
Transport, também seguindo Klebowski (2019). Esse relatório é uma análise
exploratória de dados públicos a respeito dos municípios estudados.



## 2. Base de Dados com Informações coletadas a respeito dos municípios

Abaixo há uma tabela com o nome dos municípios, data de implementação da
política e unidade federativa, essas informações foram coletadas, além
de pesquisa própria, da dissertação de mestrado de Marijke Vermander
(2021),"Exploring Fare-Free Public Transport in Brasil: Rationales and
characteristics of Tarifa Zero policies in small Brazilian
municipalitie".

```{r Tabela inicial, fig.align = 'center', out.width = "60%"}

# tabela de apresentação dos municípios estudados 
# tabela com reactable: 
  
  options(scipen=999)
  banco_completo_5  %>% 
  filter(tarifa_zero == "sim") %>% 
  select(UF, nome_muni,ano_implementacao, classe_pop, 
         Pib_Municipal_2018, renda_percapta_media, pct_pobres, prosperidade_social,  
         taxa_atividade_18_anos_ou_mais, taxa_urbanizacao, area_territorial, densidade_demografica, ocup_desl, taxa_pop_vulneravel_retorna_diariamente_trabalho, 
         indice_gini, indice_theil, idhm_class, idhm_e_class, idhm_r_class, idhm_l_class, ivs_class, ivs_infra_urbana_class, ivs_cap_class, ivs_renda_trab_class) %>% 
  mutate_if(is.character, str_to_title) %>% 
  mutate(UF = case_when(UF == "Ce" ~ "CE", UF == "Mg" ~ "MG", UF == "Sp" ~"SP", 
                        UF == "Pr" ~ "PR", UF == "Rs" ~"RS", UF == "Go" ~"GO", 
                        UF == "Rj" ~ "RJ", TRUE ~ UF)) %>% 
  mutate(pct_pobres = pct_pobres/100, taxa_atividade_18_anos_ou_mais = taxa_atividade_18_anos_ou_mais/100,
         ocup_desl = ocup_desl/100) %>% 
  arrange(ano_implementacao) %>% 
  reactable(
      defaultPageSize = 5,
      searchable = TRUE,
      outlined = FALSE, 
      showPageInfo = TRUE, 
      showPageSizeOptions = TRUE,
      defaultColDef = colDef(
      align = "center",
      headerStyle = list(background = "#f7f7f8")),
      columns = list(
      UF = colDef(minWidth = 80, align = "center"),
      nome_muni = colDef("Cidade", minWidth = 120, align = "center"),
      ano_implementacao = colDef("Ano da Implementação", minWidth = 140, align = "center"),
      classe_pop = colDef("Classe Populacional",  minWidth = 120, align = "center"),
      Pib_Municipal_2018 = colDef("PIB per Capta" , format = colFormat(prefix = "R$ ", separators = TRUE), minWidth = 120),
      renda_percapta_media = colDef("Renda Per Capta Média" , format = colFormat(prefix = "R$ ", separators = TRUE), minWidth = 150),
      prosperidade_social = colDef("Prosperidade Social", minWidth = 130),
      pct_pobres = colDef("% de Pobres" ,  format = colFormat(percent = TRUE, digits = 1), minWidth = 120), 
      taxa_atividade_18_anos_ou_mais = colDef("Taxa de Atividade 18 anos ou mais" , format = colFormat(percent = TRUE, digits = 1), minWidth = 200),
      taxa_urbanizacao = colDef("Taxa de Urbanização" , format = colFormat(percent = TRUE, digits = 1), minWidth = 120),
      ocup_desl = colDef("% de vulneráveis à pobreza que gastam mais de uma hora até o trabalho" , format = colFormat(percent = TRUE, digits = 1), minWidth = 250),
      taxa_pop_vulneravel_retorna_diariamente_trabalho = colDef("% da população ocupada vulnerável à pobreza que retorna diariamente do trabalho" , format = colFormat(percent = TRUE, digits = 1), minWidth = 250), 
      indice_gini = colDef("Índice de Gini" ,  minWidth = 100),
      indice_theil = colDef("Índice de Theil" ,  minWidth = 100),
      idhm_class = colDef("IDHM" ,  minWidth = 100),
      idhm_e_class = colDef("IDHM Educação" ,  minWidth = 100),
      idhm_r_class = colDef("IDHM Renda" ,  minWidth = 100), 
      idhm_l_class  = colDef("IDHM Longevidade" , minWidth = 120),
      ivs_class = colDef("Indice de Vulnerabilidade Social" , minWidth = 150), 
      ivs_infra_urbana_class = colDef("IVS Infraestrutura Urbana" , minWidth = 150), 
      ivs_cap_class = colDef("IVS Capital Humano" , minWidth = 150), 
      ivs_renda_trab_class = colDef("IVS Renda e Trabalho" , minWidth = 150), 
      area_territorial = colDef("Área Territorial" , format = colFormat(suffix = " km²", separators = TRUE), minWidth = 150),
      densidade_demografica = colDef("Densidade Demográfica" , format = colFormat(suffix = " hab/km²", separators = TRUE, digits = 3), minWidth = 150),
      pageSizeOptions = c(5,10,15,20,25,30), bordered = TRUE, striped = FALSE, highlight = TRUE))
     
  
  

```

## 3. Localização dos municípios

O mapa abaixo nos mostra a localização das cidades, os pontos
representam os municípios:

```{r Download GEObr, include=FALSE}

# Download dos Estados e Municípios: 

muni_geobr_1 <- read_municipality(code_muni="all", year=2018)

geo_ufs <- read_state(code_state = 'all', year = 2018)

# Estados: 

  munic_isencao_tarifa_uf <- banco_completo_5 %>% 
  select(cod_uf,tarifa_zero) %>% 
  distinct() %>% 
  rename(code_state=cod_uf)

  geo_ufs_2 <- geo_ufs  %>% 
  left_join(munic_isencao_tarifa_uf, by = c("code_state")) %>% 
  replace(is.na("tarifa_zero"), "não")

# municipios: 

  munic_isencao_tarifa_muni <- banco_completo_5  %>% 
  rename(code_muni= CodMun) %>% 
  select(code_muni,tarifa_zero, ano_implementacao) %>% 
  distinct()

  muni_geobr_3 <- muni_geobr_1 %>% 
  left_join(munic_isencao_tarifa_muni, by = c("code_muni")) %>% 
  replace(is.na("tarifa_zero"), "não") %>% 
  st_centroid() %>% 
  filter(tarifa_zero == "sim") %>% 
  rename (Municipio = name_muni)

```

```{r mapa teste, fig.align = 'center', out.width = "80%"}

geo_ufs_2 %>% 
  st_as_sf(coords=c("geom")) %>%
  ggplot() +
  geom_sf(aes(geometry = geom),color = "darkgray", fill = "seashell2", alpha = .8)  +
  geom_sf(data=muni_geobr_3,aes(fill = Municipio), shape = 21,
          color = "white",
          fill = "#b783a9",
          size = 5,
          alpha = 0.8,
          show.legend = F) +
  theme_void() +
   geom_text_repel(data=muni_geobr_3, aes(label = Municipio, geometry = geom),
                  stat = "sf_coordinates",
                  force = 1000,
                  color = "skyblue4",
                  max.overlaps = Inf)

   


```



```{r Mapa dos municipios, fig.align = 'center', out.width = "60%"}



# gráfico de mapa colocando os municípios dentro de seus respectivos estados: 

  # geo_ufs_2 %>% 
  # st_as_sf(coords=c("geom")) %>%
  # ggplot() +
  # geom_sf(aes(geometry = geom,
  #            fill = as.character(tarifa_zero)))  +
  # geom_sf(data=muni_geobr_3) +
  # theme_minimal()+
  # scale_fill_manual(values = wes_palette("Moonrise2")) +
  # labs(fill = "Tem política de FFTP?") 
  # 

```


```{r Mapa dos municipios 2, fig.align = 'center', out.width = "90%"}



#  host_cities_plot <-  geo_ufs_2 %>% 
#   st_as_sf(coords=c("geom")) %>%
#   ggplot() +
#   geom_sf(aes(geometry = geom),color = "gray", fill = "seashell2", alpha = .8)  +
#   geom_sf(data=muni_geobr_3,aes(fill = Municipio), shape = 21,
#           color = "white",
#           size = 2,
#           show.legend = F) +
#   theme_minimal()
#  
# 
# 
# ggplotly(host_cities_plot,
#          tooltip = "Municipio",
#          dynamicTicks = F)


```



Essa tabela nos mostra a região dos municípios, através dela podemos
visualizar que mais da metade (cerca de 65%) deles estão localizados no
sudeste do país. Sabemos que o nordeste é a região do Brasil com mais
municípios, seguido da região sudeste, no entanto, o nordeste só tem 2
municípios com FFTP.

```{r Região dos Municípios,fig.align = 'center', out.width = "50%"}

# Tabela com a Região dos Municípios

  banco_completo_5  %>% 
  filter(tarifa_zero == "sim") %>% 
  group_by(REGIAO) %>%
  tally() %>% 
  arrange(-n) %>% 
  kable(digits=1, col.names=c("Região", "Qtd. de Municípios")) %>%
  kable_classic_2(full_width = F, html_font = "Cambria")

```

Dos 27 estados brasileiros, sete possuem algum município que implementou
FFTP, Minas Gerais é o estado com mais municípios no Brasil mas o
segundo com mais cidades com FFTP, e São Paulo é o segundo com mais
municípios e no entando o estado com mais cidades que adotaram a
política.

```{r UF dos municípios, fig.align = 'center', out.width = "50%"}

# Tabela com a UF dos municípios 

  banco_completo_5  %>% 
  filter(tarifa_zero == "sim") %>% 
  group_by(UF) %>%
  tally() %>%
  arrange (-n) %>% 
  kable(digits=1, col.names=c("UF", "Qtd. de Municípios")) %>%
  kable_classic_2(full_width = F, html_font = "Cambria")
```

## 3. Classe Populacional 

A média populacional desses municípios é 31 mil habitantes, sendo que há
quantidades bem discrepantes, com um máximo de pouco mais de 160 mil,
como é o caso de Maricá no Rio de Janeiro, e um mínimo de 7 mil
habitantes em Pedro Osório no Rio Grande do Sul (IBGE, 2020). Abaixo
podemos visualizar a quantidade de municípios por classe
populacional,cerca de 70% dos municípios possuem entre 10 e 50 mil
habitante ao passo que não há nenhum município com mais de 500 mil
habitantes que tenha adotado a política de FFTP.

```{r Classe Populacional dos Municípios, echo=FALSE, fig.align = 'center', out.width = "50%"}

# Tabela com a classe populacional dos municípios 

 munic_interese_classe_pop <- banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  group_by(classe_pop) %>% 
  tally()

munic_geral_classe_pop <- banco_completo_5 %>% 
  filter(tarifa_zero == "não") %>% 
  group_by(classe_pop) %>% 
  tally()
  
  munic_interese_classe_pop %>% 
  inner_join(munic_geral_classe_pop, by = "classe_pop") %>% 
  rename("Classe Pop." = classe_pop, "Munic.com FFTP" = n.x, "Munic.sem FFTP" = n.y) %>%
  arrange(-`Munic.com FFTP`) %>% 
  kable(digits=1, col.names=c("Classe Populacional", 
                              "Munic.com FFTP", 
                              "Munic.sem FFTP")) %>%
  kable_classic_2(full_width = F, html_font = "Cambria") 
  

```

## 4. Ano de Implementação da Política de FFTP

Quase 70% dos municípios que adotaram FFTP o fizeram depois de 2010,
seguindo uma tendência mundial, já observada por Klebowski (2019), no
entanto, como mostrado na tabela inicial deste relatório, há três casos
de municípios que adotaram a política ainda nos anos 1990, como Monte
Carmelo (MG) que adotou em 1994, Potirendaba (SP) em 1998 e Abaeté
(MG)em 1997.

```{r Ano de Implementacao, fig.align = 'center', out.width = "65%", dpi=300}

# Gráfico ano de implementação 

  banco_completo_5  %>% 
  filter(tarifa_zero == "sim") %>% 
  group_by(ano_implemen_resumido) %>% 
  tally() %>% 
  ggplot(aes(x=ano_implemen_resumido, y =n)) + 
  geom_col(width = 0.8, fill = "#b9a6b3", colour="white", alpha = 0.9) +
  xlab("") +
  ylab("") +
  ggtitle("") +
  scale_y_continuous(breaks=seq(0,12,3))+
  geom_label(aes(x =ano_implemen_resumido, y=n, label = n), 
           position = position_stack(vjust = 0.8), fill = "beige") +
  theme_minimal() + 
    theme(plot.title = element_text(family = "serif", size = 16, face = "bold", hjust = 0.5, colour = "black"),
    text = element_text(family = "serif"),
    axis.text.x=element_text(size = 13, family = "serif"),
    axis.text.y=element_text(size = 13, family = "serif"),
    legend.title = element_blank())


```

```{r Médias da Taxa de Urbanização}

# Taxa de urbanização média 

media_urbanizacao_fftp <- banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  summarize(mean(taxa_urbanizacao)) %>% 
  round(digits = 2) %>% 
  pull()

media_urbanizacao_geral <- banco_completo_5 %>% 
  filter(tarifa_zero != "sim") %>% 
  summarize(mean(taxa_urbanizacao, na.rm = TRUE)) %>% 
  round(digits = 2) %>% 
  pull()

min_urbanizacao_fftp <- banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  summarize(min(taxa_urbanizacao)) %>% round(digits = 2) %>% 
  pull()

```

## 5. Taxa de Urbanização

No gráfico abaixo podemos observar a taxa de urbanização dos municípios estudados, a linha horizontal indica a taxa média nacional de urbanização. 

```{r Taxa de Urbanização, fig.align = 'center', out.width = "80%", dpi=300}


banco_completo_5 %>% 
  mutate(media_nacional = mean(taxa_urbanizacao)) %>% 
  filter(tarifa_zero == "sim") %>% 
  mutate_if(is.character, str_to_title) %>%
  mutate(UF = case_when(UF == "Ce" ~ "CE", UF == "Mg" ~ "MG", UF == "Sp" ~"SP", 
                        UF == "Pr" ~ "PR", UF == "Rs" ~"RS", UF == "Go" ~"GO", 
                      UF == "Rj" ~ "RJ", TRUE ~ UF)) %>% 
  ggplot() + 
  geom_col(aes(x = reorder(nome_muni, taxa_urbanizacao), y = taxa_urbanizacao, fill = UF), width = 0.65,colour="white", alpha = 0.7) +
   geom_errorbar(mapping = aes(x = nome_muni, y = media_nacional, ymin = media_nacional, ymax = media_nacional), size = 0.5) +
  xlab("") +
  ylab("") +
  ggtitle("") +
  scale_y_continuous(labels = scales::percent)+
  # scale_fill_manual(name = "", values = c("#00688b", "#0066ad", "#954182", "#1acabf", "#364955", "#00a791",  "#815074" ), labels = c("CE", "GO", "MG", "PR", "RJ", "RS", "SP"))+
  theme_minimal() + 
    scale_fill_brewer(name = "UF", palette = "Set2")+
    theme(plot.title = element_text(family = "serif", size = 12, face = "bold", hjust = 0.5, colour = "black"),
    text = element_text(family = "serif"),
    axis.text.x=element_text(size = 12, family = "serif"),
    axis.text.y=element_text(size = 10, family = "serif"),
    legend.title = element_blank())+
    coord_flip()
  

```


Há uma diferença entre as médias da taxa de urbanização dos municípios
que adotaram FFTP e os que não adotaram.A taxa média do primeiro grupo é
`r media_urbanizacao_fftp`% enquanto do segundo é
`r media_urbanizacao_geral`%. No o primeiro grupo, os municípios de
interesse desta pesquisa,dois municípios aparecem com valores que se
aproximam da média do segundo grupo, Itatiaiuçu (MG) com 62% de
urbanização e Pitanga (PR) com 63%.Os outros municípios apresentam
urbanização maior que 70%.

O grafico de densidade, logo abaixo, ilustra melhor a
distribuição das taxas de urbanização em todos os municípios
estudados.Há uma variação muito grande nos municípios que não adotaram a
política, até porque estão em muita maior quantidade.

```{r Taxa de Urbanização densidade, echo=FALSE, fig.align = 'center', out.width = "70%", dpi=300}

# Gráfico de densidade da taxa de urbanização 

banco_completo_5  %>% 
  ggplot() +
  geom_density(aes(x= taxa_urbanizacao, fill=tarifa_zero), alpha=0.5) +
  theme_minimal()+
  labs(fill = "Tem Política de FFTP?",
       title = "")+
  scale_x_continuous(labels = scales::percent)+
  xlab("") +
  ylab("") +
  scale_fill_manual(name = "Tem Política de FFTP?", values = c("#00688b", "#815074"), labels = c("Não", "Sim"))+
  theme(plot.title = element_text(family = "serif", size = 14, face = "bold", hjust = 0.5, colour = "black"),
    text = element_text(family = "serif"),
    axis.text.x=element_text(size = 11, colour = "black"),
    axis.text.y=element_text(size = 11, colour = "black"), 
    panel.spacing = unit(0.1, "lines"),
 #   strip.text.x = element_text(size = 6),
    legend.position = "bottom")


```

## 6. Densidade Demográfica

```{r densidade demográfica, fig.align = 'center', out.width = "70%", dpi=300}

# formatação  

format_densidade_demografica <- function(values, nsmall = 0) {
  values %>%
    as.numeric() %>%
    format(nsmall = nsmall, decimal.mark = ",", big.mark = ".") %>%
    str_trim() %>%
    str_c(., " hab/km²")
}

# gráfico

banco_completo_5 %>% 
  mutate(media_nacional = mean(densidade_demografica)) %>% 
  mutate(densidade_demografica = round(densidade_demografica, digits = 3))  %>% 
  filter(tarifa_zero == "sim") %>% 
  mutate_if(is.character, str_to_title) %>%
  mutate(UF = case_when(UF == "Ce" ~ "CE", UF == "Mg" ~ "MG", UF == "Sp" ~"SP", 
                        UF == "Pr" ~ "PR", UF == "Rs" ~"RS", UF == "Go" ~"GO", 
                        UF == "Rj" ~ "RJ", TRUE ~ UF)) %>% 
  ggplot() + 
  geom_col(aes(x = reorder(nome_muni, densidade_demografica), y = densidade_demografica, fill = UF), width = 0.65,colour="white", alpha = 0.7) +
   geom_errorbar(mapping = aes(x = nome_muni, y = media_nacional, ymin = media_nacional, ymax = media_nacional), size = 0.5) +
  xlab("") +
  ylab("") +
  ggtitle( "") +
  scale_fill_brewer(name = "UF", palette = "Set2")+
  scale_y_continuous(labels = format_densidade_demografica) + 
  theme_minimal() + 
    theme(plot.title = element_text(family = "serif", size = 12, face = "bold", hjust = 0.5, colour = "black"),
    text = element_text(family = "serif"),
    axis.text.x=element_text(size = 11, family = "serif"),
    axis.text.y=element_text(size = 10, family = "serif"),
    legend.title = element_blank())+
    coord_flip()

```

```{r fig.align = 'center', out.width = "65%", dpi=300}

banco_completo_5  %>% filter(densidade_demografica < 0.4) %>% 
  ggplot() +
  geom_density(aes(x= densidade_demografica, fill=tarifa_zero), alpha=0.5) +
  theme_minimal()+
  labs(fill = "Tem Política de FFTP?",
       title = "")+
  scale_x_continuous(labels = format_densidade_demografica) +
  xlab("") +
  ylab("") +
  scale_fill_manual(name = "Tem Política de FFTP?", values = c("#00688b", "#954182"), labels = c("Não", "Sim"))+
  theme(plot.title = element_text(family = "serif", size = 14, face = "bold", hjust = 0.5, colour = "black"),
    text = element_text(family = "serif"),
    axis.text.x=element_text(size = 11, colour = "black"),
    axis.text.y=element_text(size = 11, colour = "black"), 
    panel.spacing = unit(0.10, "lines"),
 #  strip.text.x = element_text(size = 6),
    legend.position = "bottom")

```

## 7. Plano de Mobilidade Urbana

Um dispositivo importante da Lei de Diretrizes da Política Nacional de
Mobilidade Urbana (Lei n.12.587/2012) é a obrigatoriedade do
desenvolvimento de planos diretores de mobilidade urbana a todos os
municípios com mais de 20 mil habitantes, de acordo com os padrões
estabelecidos pela lei, sofrendo pena de não recebimento dos repasses
destinados ao setor no caso de não apresentação do plano em até três
anos a partir da vigência da lei, além da exigência de atualização e
revisão periódica do plano. Segundo levantamento do Ministério das
Cidades em 2016, do total de 5.569 municípios brasileiros, 60% se
enquadram nos critérios estabelecidos pelo Estatuto da Cidade e pela Lei
de Mobilidade, devendo assim desenvolver o plano. Dos municípios com
FFTP apenas 12 têm a obrigação de desenvolver plano diretor. Nessa
análise consideramos apenas os municípios que no levantamento da
Secretaria Nacional de Mobilidade e Serviços Urbanos (SEMOB)responderam
"sim" ou "não" para a pergunta sobre a execução do plano de mobilidade
urbana,não tendo sido considerado as cidades que não responderam.

```{r Plano de Mobilidade Urbana}

# Tabela plano de mobilidade urbana 1 

   banco_completo_5$plano_mob <- trimws( banco_completo_5$plano_mob)
   banco_completo_5$classe_pop <- trimws( banco_completo_5$classe_pop) # não estava conseguindo filtrar essas variáveis e descobri que o problema eram os espaços 

plano_mob_2 <- banco_completo_5  %>%
   mutate(plano_mob =case_when(plano_mob =="SIM" ~"Sim",
                              TRUE~(plano_mob))) %>% 
  filter(tarifa_zero != "sim" & classe_pop != "10.000 Até 20.000" 
                              & classe_pop != "5.000 Até 10.000" 
                              & classe_pop != "Até 5.000") %>%
  group_by(plano_mob) %>%
  tally() %>% 
  filter(plano_mob != "Nao foi enviado oficio" & 
         plano_mob != "Nao respondeu") %>% 
  mutate(pct_munic_geral = n/sum(n)) %>%
  mutate(percentual = paste0(round(pct_munic_geral * 100, 1),"%")) %>% 
  select(-2, -3)

plano_mob_3 <- banco_completo_5  %>% 
    filter(tarifa_zero == "sim" & classe_pop != "10.000 Até 20.000" 
                                & classe_pop != "5.000 Até 10.000" 
                                & classe_pop != "Até 5.000") %>%  
  group_by(plano_mob) %>% 
  tally() %>% 
  filter(plano_mob != "Nao foi enviado oficio" & 
          plano_mob != "Nao respondeu") %>% 
  mutate(pct_munic_tarifa_zero = n/sum(n)) %>% 
  mutate(percentual = paste0(round(pct_munic_tarifa_zero * 100, 0),"%")) %>% 
  select(-2, -3)
  
  plano_mob_2 %>% 
  full_join(plano_mob_3, by="plano_mob") %>% 
  kable(digits=1, col.names=c("Tem Plano de Mob. Urbana?", 
                              "Munic. sem FFTP", 
                              "Munic. com FFTP")) %>%
  kable_classic_2(full_width = F, html_font = "Cambria")

  


```

Esses são os seis Municípios com a Política de Tarifa Zero, que possuem
plano de mobilidade urbana como estabelecido pela Lei Federal nº
12.587/2012, segundo levantamento da Secretaria Nacional de Mobilidade e
Serviços Urbanos (SEMOB),foi atualizado pela última vez em fevereiro de
2019.

```{r Plano de Mobilidade Tabela}

# Tabela plano de mobilidade urbana 2

tab_plano_mob <- banco_completo_5  %>% 
  filter(tarifa_zero == "sim") %>%  
  filter(plano_mob == "Sim") %>% 
  select(UF, nome_muni, classe_pop, ano_elaboracao)

tab_plano_mob %>% 
  
  mutate_if(is.character, str_to_title) %>% 
  mutate(UF = case_when(UF == "Mg" ~ "MG", UF == "Sp" ~"SP", UF == "Pr" ~ "PR", TRUE ~ UF)) %>% 
  kable(digits=2, col.names=c("UF", "Municipio", 
                              "Classe Populacional", 
                              "Ano de elaboração")) %>%
  kable_classic_2(full_width = F, html_font = "Cambria")


```

## 8. Índice de Gini e de Theil

```{r Indice de Gini e Theil media geral}

# Indíce de Gini médias

media_indice_gini_tf <- banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  summarize(mean(indice_gini)) %>% 
  round(digits = 2) %>% 
  pull()

media_indice_gini_geral <- banco_completo_5 %>% 
  filter(tarifa_zero != "sim") %>% 
  summarize(mean(indice_gini, na.rm = TRUE)) %>% 
  round(digits = 2) %>% 
  pull()

# Indíce de  Theil 

media_indice_theil_tf <- banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  summarize(mean(indice_theil)) %>% 
  round(digits = 2) %>% 
  pull()

media_indice_theil_geral <- banco_completo_5 %>% 
  filter(tarifa_zero != "sim") %>% 
  summarize(mean(indice_theil, na.rm = TRUE)) %>% 
  round(digits = 2) %>% 
  pull()



```


```{r grafico ivs infra urbana todos, fig.align = 'center', out.width = "80%", dpi=300}


banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  pivot_longer(cols = c("indice_gini", "indice_theil")) %>%
  group_by(name) %>% 
  mutate(media_nacional = mean(value)) %>% 
  mutate(name = case_when(
    name == "indice_gini" ~ "Índice de Gini",
    name == "indice_theil" ~ "Índice de Theil")) %>% 
  mutate_if(is.character, str_to_title) %>%
  mutate(UF = case_when(UF == "Ce" ~ "CE", UF == "Mg" ~ "MG", UF == "Sp" ~"SP", 
                        UF == "Pr" ~ "PR", UF == "Rs" ~"RS", UF == "Go" ~"GO", 
                      UF == "Rj" ~ "RJ", TRUE ~ UF)) %>% 
  ggplot() +
  geom_col(aes(x = reorder(nome_muni, value), y = value, fill = UF), width = 0.65,colour="white", alpha = 0.7) +
  geom_errorbar(mapping = aes(x = nome_muni, y = media_nacional, ymin = media_nacional, ymax = media_nacional), size = 0.5) +
  facet_wrap(~name) +
  theme(legend.position = "bottom") +
  theme_bw() +
  labs(fill = "UF",
       title = "") +
  xlab("") +
  ylab("") +
  scale_fill_brewer(name = "UF", palette = "Set2") +
  theme_bw() + 
    theme(plot.title = element_text(family = "serif", size = 12, face = "bold", hjust = 0.5, colour = "black"),
          strip.background = element_rect(colour = "white", fill = "#b9a6b3"),
    strip.text.x = element_text(colour = "black", hjust = 0.5, family = "serif", face = "bold"),
    text = element_text(family = "serif", size = 13),
    axis.text.x=element_text(size = 10, family = "serif"),
    axis.text.y=element_text(size = 10, family = "serif"),
    legend.title = element_blank())+
    coord_flip() 

```


ìndice de Gini dos municípios referente a 2010 - O Índice de Gini mede o
grau de concentração de renda em determinado grupo e varia de 0 a 1,
sendo 0 uma situação de completa igualdade, e 1 uma situação de completa
desigualdade. A média geral do índice de Gini nos municípios estudados é
de `r media_indice_gini_tf`, enquanto dos municípios sem FFTP é
`r media_indice_gini_geral`. Há apenas uma pequena diferença nas médias.
No entanto, no gráfico de densidade abaixo é possível observar que há
algumas diferenças na distribuição dos valores, a curva referente às
cidades com FFTP está mais à esquerda enquanto a dos outros municípios
está mais à direita.

```{r Gráfico GINI e Theil, echo=FALSE, fig.align = 'center', out.width = "80%", dpi=300}

# Gráfico GINI e Theil

banco_completo_5 %>% 
  pivot_longer(cols = c("indice_gini", "indice_theil")) %>%
  mutate(name = case_when(
    name == "indice_gini" ~ "Índice de Gini",
    name == "indice_theil" ~ "Índice de Theil")) %>% 
  ggplot() +
  geom_density(aes(value, fill=tarifa_zero), alpha = 0.5) +
  facet_wrap(~name) +
  theme(legend.position = "bottom") +
  theme_light() +
  labs(fill = "Tem Política de FFTP?",
       title = "") +
  xlab("") +
  ylab("") +
  scale_fill_manual(name = "Tem Política de FFTP?", values = c("#00688b", "#954182"), labels = c("Não", "Sim"))+
  theme(plot.title = element_text(family = "serif", size = 14, face = "bold", hjust = 0.5, colour = "black"),
        strip.background = element_rect(colour = "white", fill = "#b9a6b3"),
    strip.text.x = element_text(colour = "black", hjust = 0.5, family = "serif"),
    text = element_text(family = "serif", size = 13),
    axis.text.x=element_text(size = 10, colour = "black"),
    axis.text.y=element_text(size = 11, colour = "black"), 
    panel.spacing = unit(0.1, "lines"),
    legend.position = "bottom")

```



```{r media % de pobres}

media_pct_pobres_fftp <- banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  summarize(mean(pct_pobres)) %>% 
  round(digits = 2) %>% 
  pull()

media_pct_pobres_geral <- banco_completo_5 %>% 
  filter(tarifa_zero != "sim") %>% 
  summarize(mean(pct_pobres, na.rm = TRUE)) %>% 
  round(digits = 2) %>% 
  pull()


```

## 9. Porcentagem de Pobres

O gráfico abaixo mostra a porcentagem de pobres em cada município estudado e linha vertical representa a média nacional 

```{r Porcentagem de pobres, fig.align = 'center', out.width = "80%", dpi=300}

banco_completo_5 %>% 
  mutate(media_nacional = mean(pct_pobres/100)) %>% 
  mutate(pct_pobres = pct_pobres/100) %>% 
  filter(tarifa_zero == "sim") %>% 
  mutate_if(is.character, str_to_title) %>%
  mutate(UF = case_when(UF == "Ce" ~ "CE", UF == "Mg" ~ "MG", UF == "Sp" ~"SP", 
                        UF == "Pr" ~ "PR", UF == "Rs" ~"RS", UF == "Go" ~"GO", 
                      UF == "Rj" ~ "RJ", TRUE ~ UF)) %>% 
  ggplot() + 
  geom_col(aes(x = reorder(nome_muni, pct_pobres), y = pct_pobres, fill = UF), width = 0.65,colour="white", alpha = 0.7) +
   geom_errorbar(mapping = aes(x = nome_muni, y = media_nacional, ymin = media_nacional, ymax = media_nacional), size = 0.5) +
  xlab("") +
  ylab("") +
  ggtitle( "") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  scale_fill_brewer(name = "UF", palette = "Set2")+
  theme_minimal() + 
    theme(plot.title = element_text(family = "serif", size = 12, face = "bold", hjust = 0.5, colour = "black"),
    text = element_text(family = "serif"),
    axis.text.x=element_text(size = 12, family = "serif"),
    axis.text.y=element_text(size = 10, family = "serif"),
    legend.title = element_blank())+
    coord_flip()

```


Esse indicador considera pobre o indivíduo que recebe menos que 436
reais como renda mensal, que é a linha de pobreza recomendada
internacionalmente para uso em países de renda média-alta com é o caso
do Brasil. Há uma diferença considerável entre as médias encontradas no
grupo de cidades que adotaram FFTP e os que não adotaram. Enquanto o
primeiro grupo tem uma média de porcentagem de pobres de
`r media_pct_pobres_fftp`%, o segundo grupo tem
`r media_pct_pobres_geral`%, o que corresponde a uma diferença de 14%.
Observando o gráfico de densidade abaixo, também é possível verificar o
quanto esse percentual varia nos municípios brasileiros e também o
quanto a curva das cidades que adotaram FFTP está mais à esquerda do
gráfico.

```{r Porcentagem de Pobres densidade, echo=FALSE, fig.align='center', out.width= "70%", dpi=300}

banco_completo_5 %>% 
  mutate(pct_pobres = pct_pobres/100) %>% 
  ggplot() +
  geom_density(aes(x= pct_pobres , fill=tarifa_zero), alpha=0.5) +
  theme_minimal()+
  labs(fill = "Tem Política de FFTP?",
       title = "") +
  xlab("") +
  ylab("") +
  scale_fill_manual(name = "Tem Política de FFTP?", values = c("#00688b", "#954182"), labels = c("Não", "Sim"))+
  theme(plot.title = element_text(family = "serif", size = 14, face = "bold", hjust = 0.5, colour = "black"),
    text = element_text(family = "serif"),
    axis.text.x=element_text(size = 11, colour = "black"),
    axis.text.y=element_text(size = 11, colour = "black"), 
    panel.spacing = unit(0.1, "lines"),
    legend.position = "bottom") +
  scale_x_continuous(labels = scales::percent)
  


```

```{r deslocamento e pobreza médias}

media_deslocamento_fftp <- banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  summarize(mean(taxa_pop_vulneravel_retorna_diariamente_trabalho*100)) %>% 
  round(digits = 2) %>% 
  pull()

media_desloc_geral <- banco_completo_5 %>% 
  filter(tarifa_zero != "sim") %>% 
  summarize(mean(taxa_pop_vulneravel_retorna_diariamente_trabalho*100, na.rm = TRUE)) %>% 
  round(digits = 2) %>% 
  pull()

max_deslocamento_fftp <- banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  summarize(max(taxa_pop_vulneravel_retorna_diariamente_trabalho*100)) %>% round(digits = 2) %>% 
  pull()

```

## 11. Deslocamento e Pobreza


```{r media deslocamento e pobreza}

media_desloc_fftp <- banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  summarize(mean(ocup_desl)) %>% 
  round(digits = 2) %>% 
  pull()

media_desloc_geral <- banco_completo_5 %>% 
  filter(tarifa_zero != "sim") %>% 
  summarize(mean(ocup_desl, na.rm = TRUE)) %>% 
  round(digits = 2) %>% 
  pull()

max_urbanizacao_fftp <- banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  summarize(max(ocup_desl)) %>% round(digits = 2) %>% 
  pull()

```



```{r face wrap deslocamento urbano, fig.align='center', out.width= "80%", dpi=300}


  banco_completo_5 %>% 
  mutate(ocup_desl = ocup_desl/100) %>% 
  pivot_longer(cols = c("ocup_desl", "taxa_pop_vulneravel_retorna_diariamente_trabalho")) %>%
  group_by(name) %>% 
  mutate(media_nacional = mean(value)) %>% 
  filter(tarifa_zero == "sim") %>% 
  mutate(name = case_when(
    name == "ocup_desl" ~ "% de vulneráveis à pobreza que gastam mais de uma hora até o trabalho",
    name == "taxa_pop_vulneravel_retorna_diariamente_trabalho" ~ "% da população ocupada vulnerável à pobreza que retorna diariamente do trabalho")) %>%
  mutate_if(is.character, str_to_title) %>%
  mutate(UF = case_when(UF == "Ce" ~ "CE", UF == "Mg" ~ "MG", UF == "Sp" ~"SP", 
                        UF == "Pr" ~ "PR", UF == "Rs" ~"RS", UF == "Go" ~"GO", 
                        UF == "Rj" ~ "RJ", TRUE ~ UF)) %>% 
  ungroup() %>% 
  ggplot() +
  geom_col(aes(x = reorder(nome_muni, value), y = value, fill = UF), width = 0.65,colour="white", alpha = 0.7) +
  geom_errorbar(mapping = aes(x = nome_muni, y = media_nacional, ymin = media_nacional, ymax = media_nacional), size = 0.5) +
  facet_wrap(~name, labeller = label_wrap_gen(40)) +
  theme(legend.justification  = "bottom") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) + 
  theme_light() +
  labs(fill = "UF",
       title = "") +
  xlab("") +
  ylab("") +
  scale_fill_brewer(name = "UF", palette = "Set2") +
   theme(plot.title = element_text(family = "serif", size = 12, face = "bold", hjust = 0.5, colour = "black"),
    strip.background = element_rect(colour = "white", fill = "#b9a6b3"),
    strip.text.x = element_text(colour = "black", hjust = 0.5, family = "serif", face = "bold", size = 10),
    axis.text.x=element_text(size = 9, family = "serif"),
    axis.text.y=element_text(size = 8, family = "serif"),
    legend.title = element_blank())+
    coord_flip() 
    


```


A média da porcentagem de pessoas vulneráveis à pobreza nos municípios
que adotaram o FFTP é menos de 1%, ou mais precisamente
`r media_desloc_fftp`%, enquanto a média nos outros municípios é
`r media_desloc_geral`%. Ou seja, a diferença é realmente bem pequena.
No primeiro grupo a variação é muito menor e chega a um valor máximo de
`r max_urbanizacao_fftp`% no município de Caucaia no estado do Ceará.


## 12. PIB per capta dos municípios 2018

```{r PIB, fig.align = 'center', out.width = "80%", dpi=300}

# formatação reais 

format_real <- function(values, nsmall = 0) {
  values %>%
    as.numeric() %>%
    format(nsmall = nsmall, decimal.mark = ",", big.mark = ".") %>%
    str_trim() %>%
    str_c("R$ ", .)
}

# mapa

banco_completo_5 %>% 
  mutate(media_nacional = mean(Pib_Municipal_2018)) %>% 
  filter(tarifa_zero == "sim") %>% 
  mutate_if(is.character, str_to_title) %>%
  mutate(UF = case_when(UF == "Ce" ~ "CE", UF == "Mg" ~ "MG", UF == "Sp" ~"SP", 
                        UF == "Pr" ~ "PR", UF == "Rs" ~"RS", UF == "Go" ~"GO", 
                        UF == "Rj" ~ "RJ", TRUE ~ UF)) %>% 
  ggplot() + 
  geom_col(aes(x = reorder(nome_muni, Pib_Municipal_2018), y = Pib_Municipal_2018, fill = UF),
           width = 0.65,colour="white", alpha = 0.7) +
  geom_errorbar(mapping = aes(x = nome_muni, y = media_nacional, ymin = media_nacional, ymax = media_nacional), size = 0.5) +
  xlab("") +
  ylab("") +
  labs(title = "") + 
  coord_flip()+
  scale_y_continuous(labels = format_real, breaks=seq(0,15000000,3000000))+
  scale_fill_brewer(name = "UF", palette = "Set2")+
  theme_minimal() + 
    theme(plot.title = element_text(family = "serif", size = 12, face = "bold", hjust = 0.5, colour = "black"),
    text = element_text(family = "serif"),
    axis.text.x=element_text(size = 8.5, family = "serif"),
    axis.text.y=element_text(size = 10, family = "serif"),
    legend.title = element_blank())+
    coord_flip()


```


```{r PIB média geral}

# PIB médio 

media_pib_1 <- banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  summarize(mean(Pib_Municipal_2018)) %>%
  round(digits = 0) %>% 
  pull()

media_pib_2 <- banco_completo_5 %>% 
  filter(tarifa_zero != "sim") %>% 
  summarize(mean(Pib_Municipal_2018, na.rm = TRUE)) %>% 
  round(digits = 0) %>% 
  pull()

# formatação reais 

format_real <- function(values, nsmall = 0) {
  values %>%
    as.numeric() %>%
    format(nsmall = nsmall, decimal.mark = ",", big.mark = ".") %>%
    str_trim() %>%
    str_c("R$ ", .)
}

media_pib_1 <- format_real(media_pib_1)
media_pib_2 <- format_real(media_pib_2)
  
```


```{r grafico densidade PIB, fig.align = 'center', out.width = "80%", dpi=300}

## formatação em reais: 

format_real <- function(values, nsmall = 0) {
  values %>%
    as.numeric() %>%
    format(nsmall = nsmall, decimal.mark = ",", big.mark = ".") %>%
    str_trim() %>%
    str_c("R$ ", .)
}

## gráfico: 

banco_completo_5 %>% 
 filter(Pib_Municipal_2018 < 20000000) %>% 
  ggplot()+
  geom_density(aes(x = Pib_Municipal_2018, fill = tarifa_zero),  colour="black", alpha = 0.6) +
  labs(title = "") +
  xlab("") +
  ylab("") +
  scale_fill_manual(name = "Tem Política de FFTP?", values = c("#00688b", "#954182"), labels = c("Não", "Sim"))+
  theme_minimal()+
    theme(plot.title = element_text(family = "serif", size = 14, face = "bold", hjust = 0.5, colour = "black"),
    text = element_text(family = "serif", size = 12),
    axis.text.x=element_text(size = 10, colour = "black"),
    axis.text.y=element_blank(), 
    panel.spacing = unit(0.1, "lines"),
    legend.position = "bottom") +
    scale_x_continuous(labels = format_real)

```


O PIB per capta dos municípios estudados é de `r media_pib_1` enquanto a
média nos municípios brasileiros que não adotaram a política é
`r media_pib_2`. Olhando para essa média geral podemos dizer que o PIB
per capta dos municípios que adotaram a FFTP é quase dobro do que a
média dos municípios brasileiros que não adotaram,no entanto,quando
observamos esse valor por região e unidade federativa do
país,verificamos que esses valores podem variar bastante. Nas regiões
nordeste e sudeste, de fato, o PIB per capta, na comparação,é bem maior,
no entanto os municípios do centro oeste e sul apresentam médias
menores.


```{r PIB por região}

# Tabela de PIB por região

pib_regiao_1 <- banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  group_by(REGIAO) %>% 
  summarize(media_pib_fftp = mean(Pib_Municipal_2018))

pib_regiao_2 <- banco_completo_5 %>% 
  group_by(REGIAO) %>% 
  filter(tarifa_zero != "sim") %>% 
  summarize(media_pib_geral = mean(Pib_Municipal_2018, na.rm = TRUE)) %>% 
  filter(REGIAO != " Norte") 

# Formatação para reais: 

format_real <- function(values, nsmall = 0) {
  values %>%
    as.numeric() %>%
    format(nsmall = nsmall, decimal.mark = ",", big.mark = ".") %>%
    str_trim() %>%
    str_c("R$ ", .)
}

pib_regiao_1$media_pib_fftp <- format_real(pib_regiao_1$media_pib_fftp)
pib_regiao_2$media_pib_geral <- format_real(pib_regiao_2$media_pib_geral)


# Tabela

  pib_regiao_1 %>% full_join(pib_regiao_2, by= "REGIAO") %>% 
  kable(digits=0, col.names=c("Região", "Munic.com FFTP", "Munic.sem FFTP")) %>%
  kable_classic_2(full_width = F, html_font = "Cambria")
  


```

Os estados que apresentam média de PIB per capta dos municípios, que
adotaram a FFTP maior que os municípios que não adotaram são quatro:
Ceará, Minas Gerais, Rio de Janeiro e São Paulo. Os outros dois, Goiás e
rio Grande do Sul, são os municípios que apresentam valores menores, o
que acompanha o dado por região do pais.

```{r PIB por Estado}

# Tabela de PIB por Estado

pib_uf_1 <- banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  group_by(UF) %>% 
  summarize(media_1 = mean(Pib_Municipal_2018))

pib_uf_2 <- banco_completo_5 %>% 
  filter(UF == "CE" | UF == "GO" | UF == "MG" | UF == "PR" | UF == "RJ" | UF == "RS" | UF == "SP") %>% 
  group_by(UF) %>% 
  filter(tarifa_zero != "sim") %>% 
  summarize(media_2 = mean(Pib_Municipal_2018))

# formatando para reais

pib_uf_1$media_1 <- format_real(pib_uf_1$media_1)
pib_uf_2$media_2 <- format_real(pib_uf_2$media_2)

# tabela

pib_uf_1 %>% full_join(pib_uf_2, by= "UF") %>% 
  kable(digits=2, col.names=c("UF", "Munic.com FFTP", "Munic.sem FFTP")) %>%
  kable_classic_2(full_width = F, html_font = "Cambria")

```

```{r media - taxa de ocupação}

# média da taxa de ocupação  

taxa_ocupação_fftp <- banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  summarize(media_1 = mean(taxa_atividade_18_anos_ou_mais)) %>% 
  round(digits = 2) %>% 
  pull()


taxa_ocupação_geral <- banco_completo_5 %>% 
  filter(tarifa_zero != "sim") %>% 
  summarize(media_1 = mean(taxa_atividade_18_anos_ou_mais)) %>% 
  round(digits = 2) %>% 
  pull()


```


## 13. Prosperidade Social

```{r Prosperidade Social , fig.align = 'center', out.width = "80%", dpi=300}

  banco_completo_5  %>% 
  mutate(tarifa_zero = case_when(tarifa_zero == "sim" ~ "Municípios com Tarifa Zero", 
                                 tarifa_zero == "não"~ "Municípios sem Tarifa Zero", TRUE ~ tarifa_zero)) %>% 
  mutate(prosperidade_social = factor(prosperidade_social, levels = c("Muito Alto", "Alto", "Médio", 
        "Baixo", "Muito Baixo", ordered = T))) %>% 
  group_by(tarifa_zero, prosperidade_social) %>% 
  tally() %>% 
  mutate(pct_prosperidade = n/sum(n)) %>% 
  ggplot(aes(x = prosperidade_social, y = pct_prosperidade, fill = tarifa_zero)) + 
  geom_col(width = 0.9, position = "fill", alpha = 0.70) +
#  facet_wrap(~tarifa_zero) + 
  xlab("") +
  ylab("") +
  ggtitle("") +
  scale_y_continuous(labels = scales::percent) + 
#  scale_fill_brewer(name = "", palette = "Set2") + 
  scale_fill_manual(name = "", values = c("#00688b", "#954182"), labels = c("Municípios com Tarifa Zero", "Municípios sem Tarifa Zero")) + 
  geom_label(aes(x = prosperidade_social, y = pct_prosperidade, group = tarifa_zero, label = scales::percent(pct_prosperidade, accuracy = 1)), 
             position = position_fill(vjust = 0.5),family = "serif", fill = "beige", color = "gray22") +
  theme_minimal() + 
    theme(plot.title = element_text(family = "serif", size = 16, face = "bold", hjust = 0.5, colour = "black"),
   strip.background = element_rect(colour = "white", fill = "palevioletred"),
    strip.text.x = element_text(colour = "black", hjust = 0.5, family = "serif"),
    text = element_text(size = 14, family = "serif", colour = "gray22"),
    axis.text.x=element_text(size = 9, family = "serif"),
    axis.text.y=element_text(size = 11, family = "serif"),
    legend.title = element_blank(),
    legend.position = "bottom")



```

## 14. Taxa de Atividade 18 anos ou mais

```{r Taxa de Atividade 18 anos ou mais, fig.align = 'center', out.width = "80%", dpi=300}

banco_completo_5 %>% 
  mutate(media_nacional = mean(taxa_atividade_18_anos_ou_mais/100)) %>% 
  mutate(taxa_atividade_18_anos_ou_mais = taxa_atividade_18_anos_ou_mais/100) %>% 
  filter(tarifa_zero == "sim") %>% 
  mutate_if(is.character, str_to_title) %>%
  mutate(UF = case_when(UF == "Ce" ~ "CE", UF == "Mg" ~ "MG", UF == "Sp" ~"SP", 
                        UF == "Pr" ~ "PR", UF == "Rs" ~"RS", UF == "Go" ~"GO", 
                      UF == "Rj" ~ "RJ", TRUE ~ UF)) %>% 
  ggplot() + 
  geom_col(aes(x = reorder(nome_muni, taxa_atividade_18_anos_ou_mais), y = taxa_atividade_18_anos_ou_mais, fill = UF),
           width = 0.65,colour="white", alpha = 0.7) +
  geom_errorbar(mapping = aes(x = nome_muni, y = media_nacional, ymin = media_nacional, ymax = media_nacional), size = 0.5) +
  xlab("") +
  ylab("") +
  labs(title = "") + 
  scale_y_continuous(labels = scales::percent) +
  scale_fill_brewer(name = "UF", palette = "Set2")+
  theme_minimal() + 
    theme(plot.title = element_text(family = "serif", size = 12, face = "bold", hjust = 0.5, colour = "black"),
    text = element_text(family = "serif"),
    axis.text.x=element_text(size = 12, family = "serif"),
    axis.text.y=element_text(size = 10, family = "serif"),
    legend.title = element_blank())+
    coord_flip()


```


A taxa de atividade corresponde ao percentual da população adulta (18
anos ou mais) que é economicamente ativa, ou seja, que está ocupada ou,
procurou trabalho no mês anterior à realização da pesquisa, no caso, o
senso do IBGE de 2010. A média da taxa de ocupação nos municípios com
FFTP é `r taxa_ocupação_fftp`% enquanto nos municípios sem a política é
`r taxa_ocupação_geral`%, portanto ligeiramente maior, mas bem pouca
diferença. No gráfico abaixo podemos observar que os municípios com FFTP
estão um pouco mais à esquerda do gráfico.

```{r Taxa de Atividade 18 anos ou mais densidade, fig.align = 'center', out.width = "80%", dpi=300}


banco_completo_5 %>%   
  mutate(taxa_atividade_18_anos_ou_mais = taxa_atividade_18_anos_ou_mais/100) %>% 
  ggplot() +
  geom_density(aes(x= taxa_atividade_18_anos_ou_mais, fill=tarifa_zero), alpha=0.5) +
  theme_minimal()+
  labs(fill = "Tem Política de FFTP?",
       title = "") +
  xlab("") +
  ylab("") +
  scale_fill_manual(name = "Tem Política de FFTP?", values = c("#00688b", "#954182"), labels = c("Não", "Sim"))+
  theme(plot.title = element_text(family = "serif", size = 14, face = "bold", hjust = 0.5, colour = "black"),
    text = element_text(family = "serif"),
    axis.text.x=element_text(size = 11, colour = "black"),
    axis.text.y=element_text(size = 11, colour = "black"), 
    panel.spacing = unit(0.1, "lines"),
    legend.position = "bottom") +
  scale_x_continuous(labels = scales::percent) +
  scale_y_continuous(breaks=seq(0,8,2))
  
  
  

```

```{r media renda per capta}

renda_per_capta_fftp <- banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  summarize(media_1 = mean(renda_percapta_media)) %>% 
  round(digits = 2) %>% 
  pull()


renda_per_capta_geral <- banco_completo_5 %>% 
  filter(tarifa_zero != "sim") %>% 
  summarize(media_1 = mean(renda_percapta_media)) %>% 
  round(digits = 2) %>% 
  pull()


renda_per_capta_min <- banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  summarize(media_1 = min(renda_percapta_media)) %>% 
  round(digits = 2) %>% 
  pull()


renda_per_capta_max <- banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  summarize(media_1 = max(renda_percapta_media)) %>% 
  round(digits = 2) %>% 
  pull()
 

```

## 15. Renda Per Capta Média

```{r Renda per capta, fig.align = 'center', out.width = "70%", dpi=300}

banco_completo_5 %>% 
  mutate(media_nacional = mean(renda_percapta_media)) %>% 
  filter(tarifa_zero == "sim") %>% 
  mutate_if(is.character, str_to_title) %>%
  mutate(UF = case_when(UF == "Ce" ~ "CE", UF == "Mg" ~ "MG", UF == "Sp" ~"SP", 
                        UF == "Pr" ~ "PR", UF == "Rs" ~"RS", UF == "Go" ~"GO", 
                        UF == "Rj" ~ "RJ", TRUE ~ UF)) %>% 
  ggplot() + 
  geom_col(aes(x = reorder(nome_muni, renda_percapta_media), y = renda_percapta_media, fill = UF),
           width = 0.65,colour="white", alpha = 0.7) +
  geom_errorbar(mapping = aes(x = nome_muni, y = media_nacional, ymin = media_nacional, ymax = media_nacional), size = 0.5) +
  xlab("") +
  ylab("") +
  labs(title = "") + 
  scale_y_continuous(labels = format_real)+
  scale_fill_brewer(name = "UF", palette = "Set2")+
  theme_minimal() + 
    theme(plot.title = element_text(family = "serif", size = 12, face = "bold", hjust = 0.5, colour = "black"),
    text = element_text(family = "serif"),
    axis.text.x=element_text(size = 12, family = "serif"),
    axis.text.y=element_text(size = 10, family = "serif"),
    legend.title = element_blank())+
    coord_flip()


```


A renda per capta média é o rendimento médio individual de todos os
moradores de um determinado município. A renda média dos municípios que
adotaram FFTP é `r renda_per_capta_fftp` reais, enquanto dos municípios
que não adotaram a política é de `r renda_per_capta_geral` reais ou
seja, há uma diferença de pouco mais de 180 reais.No gráfico abaixo
podemos observar que a curva correspondentes aos municípios com FFTP
está mais à esquerda no gráfico, apesar de grande variação entre esses
municípios. A renda per capta média mínima é de `r renda_per_capta_min`
reais, do município de Aquirraz no Ceará, enquando a renda per capta
média máxima é de `r renda_per_capta_max` reais, do município de
Holambra em São Paulo.

```{r Renda percapta média densidade, fig.align = 'center', out.width = "80%", dpi=300}

renda_tarifa_zero <- banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  select(nome_muni, renda_percapta_media) %>% 
  group_by(nome_muni, renda_percapta_media) %>% 
  tally()


banco_completo_5 %>% 
  ggplot()+
  geom_density(aes(x = renda_percapta_media, fill = tarifa_zero),  colour="black", alpha = 0.6) +
  labs(title = "") +
  xlab("") +
  ylab("") +
  scale_fill_manual(name = "Tem Política de FFTP?", values = c("#00688b", "#954182"), labels = c("Não", "Sim"))+
  theme_minimal()+
    theme(plot.title = element_text(family = "serif", size = 14, face = "bold", hjust = 0.5, colour = "black"),
    text = element_text(family = "serif", size = 12),
    axis.text.x=element_text(size = 12, colour = "black"),
    axis.text.y=element_text(size = 12, colour = "black"), 
    panel.spacing = unit(0.1, "lines"),
    legend.position = "bottom") +
  scale_x_continuous(labels = format_real)



```

## 16. Índice de Vulnerabilidade Social (IVS)

```{r IVS média geral}

# média 

media_ivs_1 <- banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  summarize(mean(indice_ivs, na.rm = TRUE)) %>% round(digits = 3) %>% 
  pull()

media_ivs_2 <- banco_completo_5 %>% 
  filter(tarifa_zero != "sim") %>% 
  summarize(mean(indice_ivs, na.rm = TRUE)) %>% round(digits = 3) %>% 
  pull()

# máximo e mínimo

max_ivs_2 <- banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  summarize(max(indice_ivs, na.rm = TRUE)) %>% round(digits = 3) %>% 
  pull()

min_ivs_urbano_1 <- banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  summarize(min(indice_ivs, na.rm = TRUE)) %>% round(digits = 3) %>% 
  pull()

# infraestrutura urbana

media_ivs_urbano_1 <- banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  summarize(mean(ivs_infra_urbana, na.rm = TRUE)) %>% round(digits = 3) %>% 
  pull()

media_ivs_urbano_2 <- banco_completo_5 %>% 
  filter(tarifa_zero != "sim") %>% 
  summarize(mean(ivs_infra_urbana, na.rm = TRUE)) %>% round(digits = 3) %>% 
  pull()


```



```{r  ivs tabela}


# munic ffpt:

  ffpt_4 <- banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  select(ivs_class, ivs_cap_class, ivs_renda_trab_class, ivs_infra_urbana_class) %>% 
  pivot_longer(cols = matches("ivs")) %>% 
  group_by(name, value) %>% 
  tally() %>% 
  mutate(ivs_ffpt = n/sum(n)) %>% 
  mutate(percentual = paste0(round(ivs_ffpt * 100, 0),"%")) %>% 
  select(1,2,5) %>% 
  pivot_wider(names_from = value, values_from = percentual)


# munic sem ffpt:

  geral_4 <- banco_completo_5 %>% 
  filter(tarifa_zero != "sim") %>% 
  select(ivs_class, ivs_cap_class, ivs_renda_trab_class, ivs_infra_urbana_class) %>% 
  pivot_longer(cols = matches("ivs")) %>% 
  group_by(name, value) %>% 
  tally() %>% 
  mutate(ivs_ffpt = n/sum(n)) %>% 
  mutate(percentual = paste0(round(ivs_ffpt * 100, 0),"%")) %>% 
  select(1,2,5) %>% 
  pivot_wider(names_from = value, values_from = percentual)

# juntando as bases: 

  tbl <- ffpt_4  %>% left_join(geral_4, by = "name") %>% 
    mutate(name = case_when(name == "ivs_cap_class" ~ "Capital Humano", 
                            name == "ivs_class" ~ "Geral", 
                            name == "ivs_infra_urbana_class" ~ "Infraestrutura Urbana", 
                            name == "ivs_renda_trab_class" ~ "Renda e Trabalho", TRUE ~ name))
  
# tabela 

  tbl %>% select(name, Alta.x, Média.x, Baixa.x, `Muito Baixa.x`,  Alta.y,  Média.y, Baixa.y, `Muito Baixa.y`) %>% 
      reactable(
      defaultColDef = colDef(
      align = "center"),
      columns = list(
      name = colDef("Índice de Vulnerabilidade Social", minWidth = 150),
      Alta.x = colDef("Alta", minWidth = 70),
      Baixa.x = colDef("Baixa", minWidth = 70),
      Média.x = colDef("Média", minWidth = 70), 
      `Muito Baixa.x` = colDef("Muito Baixa", minWidth = 70),
      Alta.y = colDef("Alta", minWidth = 70),
      Baixa.y = colDef("Baixa", minWidth = 70),
      Média.y = colDef("Média", minWidth = 70), 
      `Muito Baixa.y` = colDef("Muito Baixa", minWidth = 70)), 
    columnGroups = list(
    colGroup(name = "Municípios com FFPT", columns = c("Alta.x", "Baixa.x", "Média.x", "Muito Baixa.x")),
    colGroup(name = "Municípios sem FFPT", columns = c("Alta.y", "Baixa.y", "Média.y", "Muito Baixa.y"))))
     
 

```
Segundo o Atlas da Vulnerabilidade Social nos Municípios brasileiros,
publicado IPEA em 2015, o Indice de Vulnerabilidade Social é um índice
construídos com dados do censo brasileiro, que varia entre 0 e 1, sendo
que quanto mais próximo a 1, maior é a vulnerabilidade social de um
município. O Atlas também indica a seguinte classificação dos valores
atribuídos pelo índice a cada município:

-   Entre 0 e 0,200 - muita baixa vulnerabilidade social,

-   Entre 0,201 e 0,300 - baixa vulnerabilidade social,

-   Entre 0,301 e 0,400 - média vulnerabilidade social,

-   Entre 0,401 e 0,500 são considerados de alta vulnerabilidade social

Levando essa classificação em conta, a média dos municípios que adotaram
a FFTP ficou em `r media_ivs_1` o que indica baixa vulneravilidade
social. A media nos municípios que não adotaram a política ficou em
`r media_ivs_2`, o que indica uma situação de média vulnerabilidade
social. O primeiro grupo também apresenta um valor máximo de
`r max_ivs_2` referente a cidade de Caucaia no Ceará, representando alta
vulnerabilidade social, e no outro extreno o valor de
`r min_ivs_urbano_1` na cidade de Holambra em São Paulo, correspondendo
a muita baixa vulnerabilidade social. No gráfico abaixo podemos observar
que os municípios com FFTP estão mais à esquerda do gráfico em relação a
todos os outros municípios brasileiros o que indica que eles estão, em
geral, em situção de menor vulnerabilidade social, sendo o indicador de
infraestrutura urbana o único com bem pouca diferença entre os dois
grupos. Comparando as médias desse último indicador temos que os
municípios com FFTP apresentam o valor de `r media_ivs_urbano_1`,
enquanto nos municípios que não adotaram é `r media_ivs_urbano_2`, há
bem pouca diferença, no entanto sugere que o primeiro grupo de cidades
tem um infraestrutura urbana melhor que o segundo grupo.

```{r grafico ivs, fig.align = 'center', out.width = "70%", dpi=300}


banco_completo_5 %>% 
  select(- ivs_class, -ivs_infra_urbana_class, - ivs_renda_trab_class, -ivs_cap_class) %>% 
  pivot_longer(cols = matches("ivs"))  %>% 
  mutate(tipo = case_when(
    name == "indice_ivs" ~ "Geral",
    name == "ivs_infra_urbana" ~ "Infraestrutura Urbana",
    name == "ivs_capital_humano" ~ "Capital Humano",
    name == "ivs_renda_trabalho" ~ "Renda e Trabalho")) %>% 
  mutate(tipo = factor(tipo, levels = c("Geral", "Infraestrutura Urbana", "Capital Humano", 
        "Renda e Trabalho", ordered = T))) %>% 
  ggplot() +
  geom_density(aes(value, fill=tarifa_zero), alpha = 0.5) +
  facet_wrap(~tipo) +
  theme(legend.position = "bottom") +
  theme_minimal() +
  labs(fill = "Tem Política de FFTP?",
       title = "") +
  xlab("") +
  ylab("") +
  scale_fill_manual(name = "Tem Política de FFTP?", values = c("#00688b", "#954182"), labels = c("Não", "Sim"))+
  theme(plot.title = element_text(family = "serif", size = 13, face = "bold", hjust = 0.5, colour = "black"),
        strip.background = element_rect(colour = "white", fill = "#b9a6b3"),
    strip.text.x = element_text(colour = "black", hjust = 0.5, family = "serif", face = "bold"),
    text = element_text(family = "serif", size = 13),
    axis.text.x=element_text(size = 10, colour = "black"),
    axis.text.y= element_blank(), 
    panel.spacing = unit(0.1, "lines"),
    legend.position = "bottom")
 

```

```{r ivs face wrap todos, fig.align = 'center', out.width = "80%", dpi=300 }


banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  select(- ivs_class, -ivs_infra_urbana_class, - ivs_renda_trab_class, -ivs_cap_class) %>% 
  pivot_longer(cols = matches("ivs"))  %>% 
  mutate(name = case_when(
    name == "indice_ivs" ~ "Geral",
    name == "ivs_infra_urbana" ~ "Infraestrutura Urbana",
    name == "ivs_capital_humano" ~ "Capital Humano",
    name == "ivs_renda_trabalho" ~ "Renda e Trabalho")) %>% 
  mutate(name = factor(name, levels = c("Geral", "Infraestrutura Urbana", "Capital Humano", 
        "Renda e Trabalho", ordered = T))) %>% 
  group_by(name) %>% 
  mutate(media_nacional = mean(value)) %>% 
  mutate_if(is.character, str_to_title) %>%
  mutate(UF = case_when(UF == "Ce" ~ "CE", UF == "Mg" ~ "MG", UF == "Sp" ~"SP", 
                        UF == "Pr" ~ "PR", UF == "Rs" ~"RS", UF == "Go" ~"GO", 
                        UF == "Rj" ~ "RJ", TRUE ~ UF)) %>% 
  ggplot() +
  geom_col(aes(x = reorder(nome_muni, value), y = value, fill = UF), width = 0.65,colour="white", alpha = 0.7) +
  geom_errorbar(mapping = aes(x = nome_muni, y = media_nacional, ymin = media_nacional, ymax = media_nacional), size = 0.5) +
  facet_grid(~name) +
  theme(legend.position = "bottom") +
  theme_bw() +
  labs(fill = "UF",
       title = "") +
  xlab("") +
  ylab("") +
  scale_fill_brewer(name = "UF", palette = "Set2") +
  theme_bw() + 
    theme(plot.title = element_text(family = "serif", size = 12, face = "bold", hjust = 0.5, colour = "black"),
          strip.background = element_rect(colour = "white", fill = "#b9a6b3"),
    strip.text.x = element_text(colour = "black", hjust = 0.5, family = "serif", face = "bold",size = 9),
    axis.text.x=element_text(size = 7, family = "serif"),
    axis.text.y=element_text(size = 7, family = "serif"),
    legend.title = element_blank(),
  legend.position = "bottom") +
    coord_flip() 

```


## 17. Índice de Desenvolvimento Humano (IDHM)

```{r tabela idhm}


# munic ffpt:

  ffpt_5 <- banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  select(idhm_class, idhm_r_class, idhm_e_class, idhm_l_class) %>% 
  pivot_longer(cols = matches("idhm")) %>% 
  group_by(name, value) %>% 
  tally() %>% 
  mutate(idhm_ffpt = n/sum(n)) %>% 
  mutate(percentual = paste0(round(idhm_ffpt * 100, 0),"%")) %>% 
  select(1,2,5) %>% 
  pivot_wider(names_from = value, values_from = percentual)


# munic sem ffpt:

  geral_5 <- banco_completo_5 %>% 
  filter(tarifa_zero != "sim") %>% 
  select(idhm_class, idhm_r_class, idhm_e_class, idhm_l_class) %>% 
  pivot_longer(cols = matches("idhm")) %>% 
  group_by(name, value) %>% 
  tally() %>% 
  mutate(idhm_ffpt = n/sum(n)) %>% 
  mutate(percentual = paste0(round(idhm_ffpt * 100, 0),"%")) %>% 
  select(1,2,5) %>% 
  pivot_wider(names_from = value, values_from = percentual)

# juntando as bases: 

  tbl_2 <- ffpt_5  %>% left_join(geral_5, by = "name") %>% 
    mutate(name = case_when(name == "idhm_class" ~ "Geral", 
                            name == "idhm_r_class" ~ "Renda", 
                            name == "idhm_e_class" ~ "Educação", 
                            name == "idhm_l_class" ~ "Longevidade", TRUE ~ name)) %>% 
    mutate_if(is.character, ~replace(., is.na(.), "0%"))
  
# tabela 

  tbl_2 %>% 
      select(name, Alto.x, `Muito Alto.x`, Médio.x, Baixo.x, Alto.y, `Muito Alto.y`, Médio.y, Baixo.y, `Muito Baixo`) %>% 
      reactable(
      defaultColDef = colDef(
      align = "center"),
      columns = list(
      name = colDef("Índice de Desenvolvimento Humano", minWidth = 140),
      Alto.x = colDef("Alta", minWidth = 70),
      Baixo.x = colDef("Baixa", minWidth = 70),
      Médio.x = colDef("Média", minWidth = 70), 
      `Muito Alto.x` = colDef("Muito Alto", minWidth = 70),
      Alto.y = colDef("Alta", minWidth = 70),
      Baixo.y = colDef("Baixa", minWidth = 70),
      Médio.y = colDef("Média", minWidth = 70), 
      `Muito Alto.y` = colDef("Muito Alto", minWidth = 70),
      `Muito Baixo` = colDef("Muito Baixa", minWidth = 70)), 
    columnGroups = list(
    colGroup(name = "Municípios com Tarifa Zero", columns = c("Alto.x", "Baixo.x", "Médio.x", "Muito Alto.x")),
    colGroup(name = "Municípios sem Tarifa Zero", columns = c("Alto.y", "Baixo.y", "Médio.y", "Muito Baixo","Muito Alto.y"))))
     

```


```{r IDHM média geral,  echo=FALSE}

# IDH dos municípios - média 

media_idh_1 <- banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  summarize(mean(idhm)) %>% round(digits = 2) %>% 
  pull()

media_idh_2 <- banco_completo_5 %>% 
  filter(tarifa_zero != "sim") %>% 
  summarize(mean(idhm, na.rm = TRUE)) %>% round(digits = 2) %>% 
  pull()
```

"O Índice de Desenvolvimento Humano Municipal (IDHM) é uma medida
composta de indicadores de três dimensões do desenvolvimento humano:
longevidade, educação e renda. O índice varia de 0 a 1. Quanto mais
próximo de 1, maior o desenvolvimento humano."(PNUD,2021). Segue a classificação:

-   Entre 0 e 0,499 - muito baixo

-   Entre 0,500 e 0,599 - baixo

-   Entre 0,600 e 0,699 - médio

-   Entre 0,700 e 0,799 - alto

-   Entre 0,800 e 1 - muito alto


O IDHM médio dos municípios estudados é de `r media_idh_1`, o que indica idhm "alto", enquanto a
média nos municípios brasileiros que não adotaram a política é
`r media_idh_2`, o que indica idhm "médio". Olhando para a distribuição dos valores para os dois
grupos de municípios podemos perceber que os municípios que adotaram a
política possuem valores de IDHM ligeiramente maiores.


```{r Grafico IDHM, fig.align = 'center', out.width = "70%", dpi=300}

# gráfico IDHM

banco_completo_5 %>% 
  select(- idhm_class, - idhm_e_class, - idhm_l_class, -idhm_r_class) %>% 
  pivot_longer(starts_with("idhm")) %>% 
  mutate(tipo = case_when(
    name == "idhm" ~ "Geral",
    name == "idhm_e" ~ "Educação",
    name == "idhm_l" ~ "Longevidade",
    name == "idhm_r" ~ "Renda")) %>% 
  mutate(tipo = factor(tipo, levels = c("Geral", "Educação", "Renda", 
        "Longevidade", ordered = T))) %>% 
  ggplot() +
  geom_density(aes(value, fill=tarifa_zero), alpha = 0.5) +
  facet_wrap(~tipo) +
  theme(legend.position = "bottom") +
  theme_minimal() +
  labs(fill = "Tem Política de FFTP?",
       title = "") +
  xlab("") +
  ylab("") +
  scale_fill_manual(name = "Tem Política de FFTP?", values = c("#00688b", "#954182"), labels = c("Não", "Sim"))+
  theme(plot.title = element_text(family = "serif", size = 13, face = "bold", hjust = 0.5, colour = "black"),
    text = element_text(family = "serif", size = 13),
    strip.background = element_rect(colour = "white", fill = "#b9a6b3"),
    strip.text.x = element_text(colour = "black", face = "bold", hjust = 0.5, family = "serif"),
    axis.text.x=element_text(size = 10, colour = "black"),
    axis.text.y= element_blank(), 
    panel.spacing = unit(0.1, "lines"),
    legend.position = "bottom")

```


```{r idhm face wrap todos, fig.align = 'center', out.width = "80%", dpi=300 }


banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  select(- idhm_class, - idhm_e_class, - idhm_l_class, -idhm_r_class) %>% 
  pivot_longer(starts_with("idhm")) %>% 
  mutate(name = case_when(
    name == "idhm" ~ "Geral",
    name == "idhm_e" ~ "Educação",
    name == "idhm_l" ~ "Longevidade",
    name == "idhm_r" ~ "Renda")) %>% 
  mutate(name = factor(name, levels = c("Geral", "Educação", "Renda", 
        "Longevidade", ordered = T))) %>% 
  group_by(name) %>% 
  mutate(media_nacional = mean(value)) %>% 
  mutate_if(is.character, str_to_title) %>%
  mutate(UF = case_when(UF == "Ce" ~ "CE", UF == "Mg" ~ "MG", UF == "Sp" ~"SP", 
                        UF == "Pr" ~ "PR", UF == "Rs" ~"RS", UF == "Go" ~"GO", 
                        UF == "Rj" ~ "RJ", TRUE ~ UF)) %>% 
  ggplot() +
  geom_col(aes(x = reorder(nome_muni, value), y = value, fill = UF), width = 0.65,colour="white", alpha = 0.7) +
  geom_errorbar(mapping = aes(x = nome_muni, y = media_nacional, ymin = media_nacional, ymax = media_nacional), size = 0.5) +
  facet_grid(~name) +
  theme(legend.position = "bottom") +
  theme_bw() +
  labs(fill = "UF",
       title = "Índice de Desenolvimento Humano") +
  xlab("") +
  ylab("") +
  scale_fill_brewer(name = "UF", palette = "Set2") +
  theme_light() + 
    theme(plot.title = element_text(family = "serif", size = 12, face = "bold", hjust = 0.5, colour = "black"),
          strip.background = element_rect(colour = "white", fill = "#b9a6b3"),
    strip.text.x = element_text(colour = "black", hjust = 0.5, family = "serif", face = "bold",size = 10),
    axis.text.x=element_text(size = 7, family = "serif"),
    axis.text.y=element_text(size = 7, family = "serif"),
    legend.title = element_blank(),
  legend.position = "bottom") +
    coord_flip() 

```


```{r IDHM Renda dos municípios, echo=FALSE, fig.align = 'center', out.width = "80%", dpi=300}

# IDHM  Renda dos municípios (média) 

media_idh_renda_1 <- banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  summarize(mean(idhm_r)) %>% 
  round(digits = 2) %>% 
  pull()

media_idh_renda_2 <- banco_completo_5 %>% 
  filter(tarifa_zero != "sim") %>% 
  summarize(mean(idhm_r, na.rm = TRUE)) %>% 
  round(digits = 2) %>% 
  pull()



```

A média do IDHM Renda dos municípios estudados é de
`r media_idh_renda_1`, ou seja, "alto", enquanto a média nos municípios brasileiros que
não adotaram a política é `r media_idh_renda_2`, ou seja, médio.
De fato, quando olhamos para a distribuição dos valores no gráfico de
densidade, percebemos que os municípios que adotaram FFTP apresentam
valores mais próximos de 1, estando inclinados mais à esquerda do
gráfico.

```{r IDH Educação, echo=FALSE, fig.align = 'center', out.width = "80%", dpi=300}

# IDHM Educação média

media_idh_1 <- banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  summarize(mean(idhm_e)) %>% 
  round(digits = 2) %>% 
  pull()

media_idh_2 <- banco_completo_5 %>% 
  filter(tarifa_zero != "sim") %>% 
  summarize(mean(idhm_e, na.rm = TRUE)) %>% 
  round(digits = 2) %>% 
  pull()

##

```

A média do IDHM Educação dos municípios com FFTP é de `r media_idh_1`
enquanto a média nos municípios brasileiros que não adotaram a política
é `r media_idh_2`. Assim, como no gráfico de densidade do IDHM geral e IDHM renda, os
municípios com FFTP apresentam valores mais próximos de 1 e mais à esquerda do
gráfico de densidade. 

```{r IDHM Educação, echo=FALSE, fig.align = 'center', out.width = "50%", dpi=300}

# IDH Longevidade média

media_idh_longevidade_1 <- banco_completo_5 %>% 
  filter(tarifa_zero == "sim") %>% 
  summarize(mean(idhm_l)) %>% 
  round(digits = 2) %>% 
  pull()

media_idh_logenvidade_2 <- banco_completo_5 %>% 
  filter(tarifa_zero != "sim") %>% 
  summarize(mean(idhm_l, na.rm = TRUE)) %>% 
  round(digits = 2) %>% 
  pull()


```

Por fim, a média do IDHM longevidade dos municípios estudados é de
`r media_idh_longevidade_1` enquanto a média nos municípios brasileiros
que não adotaram a política é `r media_idh_logenvidade_2`.Aqui há apenas uma pequena 
diferença entre os dois grupos, 
que estão no mesmo grupo de idhm "muito alto". 

A respeito dos indicadores de IDHM: renda, educação e longevidade,
podemos dizer que, em termos de renda e educação, os municípios
que adotaram o FFTP tem uma diferença de 7 pontos a mais na média de
valores do indicador em relação aos municípios sem essa política. Em
relação a longevidade, as médias apresentam valores praticamente semelhantes.

## 18. Motivação dos governos



## 19. Movimentos Sociais e Tarifa Zero

```{r banco passe livre}

mov_passe_livre <- tibble(CodMun=c(3550308, 4205407, 4209102, 3136702, 3543402, 2507507, 2914802, 3304557, 3549904, 3302205, 3143302, 2111300,  1302603, 3170206, 3539806,5002704, 3518800, 2513703, 2408102, 2704302, 3548500, 4204202, 2927408, 2513851, 3522208, 3520400, 1501402, 5103403,  
3106200, 4314407, 2304400, 1200401, 3525300, 4113700, 3303807, 3304201, 3516309,  3503208),
        nome_movi_passe_livre=c("Passe Livre São Paulo", "Passe Livre Floripa", "Passe Livre Joinville", "Passe Livre Juiz de Fora", "Passe Livre Ribeirão Preto", "Passe Livre João Pessoa", "Passe Livre Itabuna", "Passe Livre Rio de Janeiro", "Passe Livre São José dos Campos", "Passe Livre Itaperuna", "Passe Livre Montes Claros", "Passe Livre Manaus", "Passe Livre Maranhão", "Passe Livre Uberlândia", "Passe Livre Poá", "Passe Livre Mato Grosso do Sul", "Passe Livre Guarulhos", "Passe Livre Santa Rita", "Passe Livre Natal", "Passe Livre Maceió", "Passe Livre Santos", "Passe Livre Chapecó", "Passe Livre Salvador", "Passe Livre Região Grande ABC", "Passe Livre Itapecerica da Serra", "Passe Livre Ilhabela", "Passe Livre Belém","Passe Livre Cuiabá", "Passe Livre Belo Horizonte", "Passe Livre Pelotas", "Passe Livre Fortaleza", "Passe Livre Acre", "Passe Livre Jaú", "Passe Livre Londrina", "Passe Livre Paraty", "Passe Livre Resende", "Passe Livre Francisco Morato", "Passe Livre Araraquara"))

mov_tarifa_zero <- tibble(CodMun = c(2927408,2606200, 2800308, 2913606, 3106200, 4209102, 4106902, 3516200, 3303500, 3506003, 4202404, 3531803), 
                          nome_movi_tarifa_zero = c("Tarifa Zero Salvador", "Tarifa Zero Goiânia", "Tarifa Zero Aracaju", "Tarifa Zero Ilhéus", "Tarifa Zero BH", "Tarifa Zero Joinville", "Tarifa Zero Curitiba", "Tarifa Zero Franca", "Tarifa Zero Nova Iguaçu", "Tarifa Zero Bauru", "Tarifa Zero Blumenau",  "Tarifa Zero de Monte Mor"))

banco_completo_6 <- banco_completo_5 %>% 
  left_join(mov_passe_livre, by = "CodMun") %>% 
  left_join(mov_tarifa_zero, by = "CodMun")



```


```{r mapa mov. sociais}

# Estados: 

  ffpt_uf <- banco_completo_6 %>% 
  select(cod_uf,tarifa_zero, nome_movi_passe_livre, nome_movi_tarifa_zero) %>% 
  distinct() %>% 
  rename(code_state=cod_uf)

  geo_ufs_3 <- geo_ufs  %>% 
  left_join(ffpt_uf, by = c("code_state")) %>% 
  replace(is.na("tarifa_zero"), "não")

# municipios: 

  ffpt_muni <- banco_completo_6  %>% 
  rename(code_muni= CodMun) %>% 
  select(code_muni,tarifa_zero, nome_movi_passe_livre, nome_movi_tarifa_zero) %>% 
  distinct()
  
  # camada cidades com tarifa_zero
  
  muni_geobr_4 <- muni_geobr_1 %>% 
  left_join(ffpt_muni, by = c("code_muni")) %>% 
  replace(is.na("tarifa_zero"), "não") %>% 
  st_centroid() %>% 
  filter(tarifa_zero == "sim") %>% 
  rename(`Cidades com Tarifa Zero` = name_muni)
  
  ## camada movimento passe livre
  
  muni_geobr_5 <- muni_geobr_1 %>% 
  left_join(ffpt_muni, by = c("code_muni")) %>% 
  replace(is.na("nome_movi_passe_livre"), "não") %>% 
  st_centroid() %>% 
  filter(nome_movi_passe_livre != "não") %>% 
  rename(`Cidades com Movimento Passe Livre` = nome_movi_passe_livre)
  
  ## camada  movimento tarifa_zero
  
  muni_geobr_6 <- muni_geobr_1 %>% 
  left_join(ffpt_muni, by = c("code_muni")) %>% 
  replace(is.na("nome_movi_tarifa_zero"), "não") %>% 
  st_centroid() %>% 
  filter(nome_movi_tarifa_zero != "não") %>% 
  rename(`Cidades com Movimento Tarifa Zero` = nome_movi_tarifa_zero)
  




```

```{r mapa mov. sociais plot, fig.align = 'center', out.width = "80%", dpi=300}


# gráfico de mapa colocando os municípios dentro de seus respectivos estados: 
  
  geo_ufs_3 %>% 
  st_as_sf(coords=c("geom")) %>%
  ggplot() +
  geom_sf(aes(geometry = geom), color = "gray", fill = "seashell2")  +
  geom_sf(data=muni_geobr_4, aes(fill = "Cidades com Tarifa Zero"), shape = 21,
          color = "white",
          size = 4,
          show.legend = T, 
          alpha = 0.6) +
  geom_sf(data= muni_geobr_5, aes(fill = "Cidades com Movimento Passe Livre"), shape = 21,
          color = "white",
          size = 4,
          show.legend = T,
          alpha = 0.6) +
  geom_sf(data= muni_geobr_6, aes(fill = "Cidades com Movimento Tarifa Zero"), shape = 21,
          color = "white",
          size = 4,
          show.legend = T,
          alpha = 0.6) + 
  theme_minimal() + 
  labs(fill = "",
       title = "", 
       caption = "")+
   scale_fill_manual(name = "", values = c("#00688b", "#a14146", "#446b19"), labels = c("Cidades com Tarifa Zero", 
                                                                                        "Cidades com Movimento Passe Livre", 
                                                                                        "Cidades com Movimento Tarifa Zero"))+
   theme(plot.title = element_text(family = "serif", size = 12, vjust = 0.0010, hjust = 0.5, color = "cornsilk4"),
         plot.caption = element_text(family = "roboto", size = 9, color = "#404040", hjust = 0.9),
         text = element_text(family = "serif", size = 12))
  
   
# ggplotly(host_cities_plot_2,
#          tooltip = "Municipio",
#          dynamicTicks = F)

```

